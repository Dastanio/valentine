<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0611" />
  <title>üíå –í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ –¥–ª—è –ù—É—Ä—ã</title>

  <style>
    :root{
      --bg0:#07040c;
      --bg1:#140a22;
      --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --hot:#ff2e73;
      --hot2:#ff5aa0;
      --mint:#6ef7d3;
      --gold:#ffd27a;
      --shadow: 0 24px 70px rgba(0,0,0,.55);
      --shadow2: 0 12px 30px rgba(0,0,0,.35);
      --r: 18px;
      --r2: 26px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bot: env(safe-area-inset-bottom, 0px);
      --vh: 1vh;
      --blur: 18px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 20% 0%, rgba(255,46,115,.20) 0%, rgba(255,46,115,0) 60%),
        radial-gradient(1000px 800px at 90% 20%, rgba(110,247,211,.16) 0%, rgba(110,247,211,0) 55%),
        radial-gradient(900px 700px at 60% 100%, rgba(255,210,122,.14) 0%, rgba(255,210,122,0) 55%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg0) 100%);
      overflow-x:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* subtle noise */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.05;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    /* floating blobs */
    .blob{
      position:fixed;
      width:320px; height:320px;
      border-radius: 999px;
      filter: blur(38px);
      opacity:.18;
      pointer-events:none;
      transform: translate3d(0,0,0);
      animation: blobFloat 14s ease-in-out infinite;
    }
    .blob.b1{ left:-90px; top: 80px; background: radial-gradient(circle at 30% 30%, rgba(255,46,115,1), rgba(255,46,115,0)); animation-duration: 16s; }
    .blob.b2{ right:-120px; top: 160px; background: radial-gradient(circle at 30% 30%, rgba(110,247,211,1), rgba(110,247,211,0)); animation-duration: 18s; animation-delay:-6s;}
    .blob.b3{ left:20px; bottom: -120px; background: radial-gradient(circle at 30% 30%, rgba(255,210,122,1), rgba(255,210,122,0)); animation-duration: 20s; animation-delay:-9s;}
    @keyframes blobFloat{
      0%,100%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(14px,-18px,0) scale(1.08); }
    }

    /* canvas hearts */
    canvas#hearts{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;
      opacity:.95;
    }

    .app{
      position:relative;
      z-index:1;
      min-height: calc(var(--vh) * 100);
      padding: calc(16px + var(--safe-top)) 14px calc(18px + var(--safe-bot));
      display:flex;
      flex-direction:column;
      gap:14px;
      max-width: 520px;
      margin: 0 auto;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px;
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border: 1px solid var(--stroke);
      backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow2);
      position:sticky;
      top: calc(10px + var(--safe-top));
      z-index: 4;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .mark{
      width: 40px; height: 40px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.25), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,46,115,.95), rgba(110,247,211,.75));
      box-shadow: 0 12px 30px rgba(255,46,115,.18);
      border: 1px solid rgba(255,255,255,.22);
      position:relative;
      overflow:hidden;
    }
    .mark::after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 40deg, rgba(255,255,255,.0), rgba(255,255,255,.45), rgba(255,255,255,0));
      animation: shine 3.8s linear infinite;
      opacity:.55;
    }
    @keyframes shine { to{ transform: rotate(360deg); } }
    .mark span{ font-size:18px; filter: drop-shadow(0 8px 18px rgba(0,0,0,.45)); position:relative; z-index:1;}

    .brand .t{
      display:flex; flex-direction:column;
      line-height:1.05;
      min-width:0;
    }
    .brand .t strong{
      font-size: 13px;
      letter-spacing:.3px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .t small{
      font-size: 11px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 9px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 20px rgba(0,0,0,.18);
      user-select:none;
      min-width: 0;
    }
    .chip .dot{
      width:8px; height:8px;
      border-radius: 99px;
      background: radial-gradient(circle at 30% 30%, var(--mint), rgba(110,247,211,.15));
      box-shadow: 0 0 0 6px rgba(110,247,211,.08);
      animation: pulse 2.2s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); opacity:1;}
      50%{ transform: scale(1.2); opacity:.85;}
    }
    .chip span{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 180px;
    }

    .stage{
      position:relative;
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow);
      overflow:hidden;
      padding: 18px 14px 14px;
    }
    .stage::before{
      content:"";
      position:absolute; inset:-120px -120px auto auto;
      width: 260px; height: 260px;
      background: radial-gradient(circle at 30% 30%, rgba(255,46,115,.35), rgba(255,46,115,0) 70%);
      filter: blur(12px);
      transform: rotate(10deg);
    }
    .stage::after{
      content:"";
      position:absolute; inset:auto auto -140px -130px;
      width: 300px; height: 300px;
      background: radial-gradient(circle at 30% 30%, rgba(110,247,211,.26), rgba(110,247,211,0) 70%);
      filter: blur(12px);
      transform: rotate(-10deg);
    }

    .step{
      position:relative;
      z-index:1;
      display:none;
      animation: stepIn .55s cubic-bezier(.2,.9,.2,1) both;
    }
    .step.active{ display:block; }
    @keyframes stepIn{
      from{ transform: translateY(10px) scale(.985); opacity:0; filter: blur(6px); }
      to{ transform: translateY(0) scale(1); opacity:1; filter: blur(0); }
    }

    .kicker{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 10px;
    }
    .kicker .mini{
      width: 8px; height: 8px;
      border-radius: 99px;
      background: radial-gradient(circle at 30% 30%, var(--hot2), rgba(255,46,115,.1));
      box-shadow: 0 0 0 6px rgba(255,46,115,.10);
    }

    h1{
      margin: 0 0 8px;
      font-size: 24px;
      line-height:1.08;
      letter-spacing:-.2px;
    }
    p{
      margin:0 0 14px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      flex: 1 1 auto;
      min-width: 120px;
      border: 0;
      border-radius: 999px;
      padding: 13px 14px;
      color: rgba(255,255,255,.95);
      font-weight: 700;
      letter-spacing:.2px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 30px rgba(0,0,0,.22);
      backdrop-filter: blur(12px);
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      position:relative;
      overflow:hidden;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(255,46,115,.95), rgba(255,90,160,.86));
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 40px rgba(255,46,115,.22);
    }
    .btn.primary::before{
      content:"";
      position:absolute; inset:-60% -40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), rgba(255,255,255,0) 55%);
      transform: rotate(18deg);
      opacity:.32;
    }

    .btn.secondary{
      background: linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
    }
    .btn.ghost{
      background: rgba(255,255,255,.04);
      border: 1px dashed rgba(255,255,255,.20);
      color: rgba(255,255,255,.85);
    }
    .btn.small{
      padding: 10px 12px;
      font-size: 12px;
      min-width:auto;
      flex:0 0 auto;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin: 10px 0 14px;
    }
    label{
      font-size: 12px;
      color: rgba(255,255,255,.85);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    label small{ color: var(--muted); font-weight: 500; }
    input[type="text"]{
      width:100%;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      outline:none;
      font-size: 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    input[type="text"]::placeholder{ color: rgba(255,255,255,.45); }

    .progress{
      margin-top: 10px;
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      position:relative;
      z-index:1;
    }
    .p{
      width: 10px; height: 10px;
      border-radius: 99px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.18);
      transition: transform .2s ease, background .2s ease, opacity .2s ease;
      opacity:.7;
    }
    .p.on{
      background: linear-gradient(135deg, rgba(255,46,115,.95), rgba(110,247,211,.75));
      opacity:1;
      transform: scale(1.25);
      box-shadow: 0 0 0 6px rgba(255,46,115,.08);
    }

    /* Gallery */
    .gallery{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 14px;
    }
    .ph{
      aspect-ratio: 1 / 1.18;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), rgba(255,255,255,0) 55%),
        linear-gradient(135deg, rgba(255,46,115,.22), rgba(110,247,211,.14)),
        rgba(0,0,0,.18);
      overflow:hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.28);
      position:relative;
      transform: translateZ(0);
    }
    .ph img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      filter: saturate(1.04) contrast(1.02);
      transform: scale(1.02);
    }
    .ph .tag{
      position:absolute;
      left: 10px; bottom: 10px;
      padding: 7px 10px;
      font-size: 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.88);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
    }
    .ph::after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 60deg, rgba(255,255,255,0), rgba(255,255,255,.30), rgba(255,255,255,0));
      opacity:.20;
      animation: shine 6s linear infinite;
      pointer-events:none;
    }

    .note{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.86);
      font-size: 13px;
      line-height:1.55;
      box-shadow: 0 16px 38px rgba(0,0,0,.18);
      position:relative;
      overflow:hidden;
    }
    .note b{ color: rgba(255,255,255,.95); }
    .note .spark{
      position:absolute;
      right: 10px; top: 10px;
      font-size: 16px;
      opacity:.9;
      animation: twinkle 1.8s ease-in-out infinite;
    }
    @keyframes twinkle{ 0%,100%{ transform: rotate(0deg) scale(1); opacity:.85; } 50%{ transform: rotate(12deg) scale(1.08); opacity:1; } }

    .divider{
      height:1px;
      background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.18), rgba(255,255,255,0));
      margin: 14px 0;
      opacity:.8;
    }

    /* Toast */
    .toast{
      position:fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(18px + var(--safe-bot));
      width: min(520px, calc(100% - 24px));
      padding: 12px 12px;
      border-radius: 18px;
      background: rgba(12, 7, 18, .72);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow2);
      display:flex;
      gap:10px;
      align-items:flex-start;
      z-index: 10;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-6px);
    }
    .toast .ico{
      width: 34px; height: 34px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      flex:0 0 auto;
    }
    .toast .txt{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .toast .txt strong{ font-size: 12px; }
    .toast .txt small{ font-size: 11px; color: var(--muted); line-height:1.35; }

    /* modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      z-index: 20;
      padding: calc(16px + var(--safe-top)) 14px calc(16px + var(--safe-bot));
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    .modal.show{ display:flex; }
    .sheet{
      margin:auto;
      width: min(520px, 100%);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      animation: sheetIn .28s ease forwards;
    }
    @keyframes sheetIn{
      to{ transform: translateY(0); opacity:1; }
    }
    .sheet header{
      padding: 14px 14px 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .sheet header strong{ font-size: 13px; letter-spacing:.2px; }
    .sheet .body{
      padding: 12px 14px 14px;
    }
    .sheet .body p{ margin-bottom: 10px; }
    .sheet textarea{
      width:100%;
      min-height: 110px;
      resize:none;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      outline:none;
      font-size: 14px;
      line-height:1.45;
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce){
      *{ animation-duration: .01ms !important; animation-iteration-count: 1 !important; transition-duration: .01ms !important; scroll-behavior:auto !important; }
      canvas#hearts{ display:none; }
    }
  </style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <canvas id="hearts"></canvas>

  <main class="app">
    <div class="topbar">
      <div class="brand">
        <div class="mark"><span>üíó</span></div>
        <div class="t">
          <strong id="titleBar">–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞</strong>
          <small id="subBar">D&N</small>
        </div>
      </div>
      <div class="chip" id="chip">
        <div class="dot"></div>
        <span id="chipText">—à–∞–≥ 1 –∏–∑ 5</span>
      </div>
    </div>

    <section class="stage" id="stage">

      <!-- STEP 1 -->
      <div class="step active" data-step="1">
        <div class="kicker"><span class="mini"></span><span>–í—Ö–æ–¥ –≤ –∫–≤–µ—Å—Ç</span></div>
        <h1>D&N ‚ú®</h1>
        <p>
          –≠—Ç–æ –º–∞–ª–µ–Ω—å–∫–∞—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ –æ—Ç <b>–º–µ–Ω—è</b>.<br>
          –î–ª—è —Å–∞–º–æ–π –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–π –∏ –Ω–µ–∂–Ω–æ–π –¥–µ–≤—É—à–∫–∏ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏<br>
          –î–ª—è –¥–µ–≤—É—à–∫–∏, –ø—Ä–∏—Ö–æ–¥–æ–º –∫–æ—Ç–æ—Ä–æ–π –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –º–æ—è –∂–∏–∑–Ω—å. 
        </p>
        <div class="field">
          <!-- <label>–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? <small>(–º–æ–∂–Ω–æ –º–∏–ª–æ)</small></label> -->
          <input id="girlName" type="text" disabled value="–ù—É—Ä–∞ üíù" autocomplete="off" />
        </div>

        <div class="actions">
          <button class="btn primary" id="startBtn">–ù–∞—á–∞—Ç—å</button>
          <!-- <button class="btn ghost" id="skipNameBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button> -->
        </div><br>

        <div class="progress" aria-hidden="true">
          <div class="p on"></div><div class="p"></div><div class="p"></div><div class="p"></div><div class="p"></div>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="step" data-step="2">
        <div class="kicker"><span class="mini"></span><span>–¢–≤–æ–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞</span></div>
        <h1 id="step2Title">–ó–¥–µ—Å—å —è —Å–æ–±—Ä–∞–ª —Ç–æ, —á—Ç–æ —è –∑–∞–º–µ—Ç–∏–ª, –∏ —Ç–≤–æ–∏ —Ö–æ—Ç–µ–ª–∫–∏ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è –Ω–∞—à–µ–≥–æ –æ–±—â–µ–Ω–∏—è.</h1>
        <p>
          –ñ–º—è–∫–Ω–∏ –Ω–∞ —Ç–æ —á—Ç–æ —Å—á–∏—Ç–∞–µ—à—å 10000%<br>
          –Ø —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–±—Ä–∞–ª –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ —Ç—ã –ª—é–±–∏—à—å üí´
        </p>

        <div class="actions">
          <button class="btn secondary" data-ans="–ø—Ä–∏–≥–æ—Ç–æ–≤–ª—é —Ç–µ–±–µ –≥—Ä–µ—á–∫—É">ü•£ –ì—Ä–µ—á–∫–∞</button>
          <button class="btn secondary" data-ans="–ø—Ä–∏–≥–æ—Ç–æ–≤–ª—é —Ç–µ–±–µ –∫—É—Ä–∏—Ü—É">üçó –ö—É—Ä–∏—Ü–∞ –≤ –∫–∏—Å–ª–æ-—Å–ª–∞–¥–∫–æ–º</button>
          <button class="btn secondary" data-ans="–Ω–∞—Ä–∏—Å—É—é —Ç–µ–±—è">üé® –†–∏—Å–æ–≤–∞—Ç—å / –∏—Å–∫—É—Å—Å—Ç–≤–æ —Ä—É–∫–∞–º–∏</button>
          <button class="btn secondary" data-ans="–∫—É–ø–ª—é —á—Ç–æ —Ç–æ –ª–µ–æ–ø–∞—Ä–¥–æ–≤–æ–µ">üêÜ –õ–µ–æ–ø–∞—Ä–¥–æ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏</button>
          <button class="btn secondary" data-ans="–ø—Ä–∏–≥–æ—Ç–æ–≤–ª—é –∫–µ–±–∞–±">ü•© –õ—é–±–∏—Ç –∫–µ–±–∞–±</button>
          <button class="btn secondary" data-ans="–ø–æ—à–æ–ø–∏–º—Å—è">üõç –õ—é–±–∏—Ç —à–æ–ø–∏—Ç—Å—è –æ–Ω–ª–∞–π–Ω</button>
        </div>

        <div class="divider"></div>
        <div class="actions">
          <button class="btn ghost small" id="back2">‚Üê –ù–∞–∑–∞–¥</button>
          <button class="btn primary" id="next2" disabled>–î–∞–ª—å—à–µ</button>
        </div>

        <div class="progress" aria-hidden="true">
          <div class="p"></div><div class="p on"></div><div class="p"></div><div class="p"></div><div class="p"></div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="step" data-step="3">
        <div class="kicker"><span class="mini"></span><span>–ú–∏–Ω–∏-–º–∏—Å—Å–∏—è</span></div>
        <h1>–°–µ—Ä–¥—Ü–µ ‚Äú–Ω–∞—à–∏—Ö –ø–ª–∞–Ω–æ–≤‚Äù</h1>
        <p>
          –ù–∞–∂–º–∏ –Ω–∞ —Å–µ—Ä–¥—Ü–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ‚Äú–Ω–∞—à —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥‚Äù.
          (–ü–æ–¥—Å–∫–∞–∑–∫–∞: –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö —Å–ª–µ–≥–∫–∞ –¥—Ä–æ–∂–∏—Ç üòâ)
        </p>

        <div class="actions" id="heartsGrid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <button class="btn secondary" data-heart="A">üíç –°–≤–∞–¥—å–±–∞</button>
          <button class="btn secondary" data-heart="B" id="wobbleHeart">üíó 2026 ‚Äî –≤—Å—Ç—Ä–µ—á–∞</button>
          <button class="btn secondary" data-heart="C">üíò –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω</button>
          <button class="btn secondary" data-heart="D">üíù –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
        </div>

        <div class="divider"></div>
        <div class="actions">
          <button class="btn ghost small" id="back3">‚Üê –ù–∞–∑–∞–¥</button>
          <button class="btn primary" id="next3" disabled>–î–∞–ª—å—à–µ</button>
        </div>

        <div class="progress" aria-hidden="true">
          <div class="p"></div><div class="p"></div><div class="p on"></div><div class="p"></div><div class="p"></div>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="step" data-step="4">
        <div class="kicker"><span class="mini"></span><span>–°–∞–º–∞—è –ª—É—á—à–∞—è –ø–∞—Ä–∞ –≤ –º–∏—Ä–µ</span></div>
        <h1 style="text-align: center;">D ü§ç N</h1>
        <p style="text-align: center;">
          –î–∞ —Ç—ã —á–µ ?<br>
          –ë–∞–∑–∞—Ä—É –Ω–µ—Ç
        </p>

        <div class="gallery">
          <div class="ph">
            <img id="imgMe" alt="–§–æ—Ç–æ –î–∞—Å—Ç–∞–Ω–∞" src="assets/me.jpg" />
            <div class="tag">–Ø–Ø–Ø–Ø</div>
          </div>
          <div class="ph">
            <img id="imgHer" alt="–§–æ—Ç–æ –ù—É—Ä—ã" src="assets/her.jpg" />
            <div class="tag" id="herTag">–ñ–∞–Ω—ã–º–∫–∞</div>
          </div>
        </div>

        <div class="note" id="interestsNote">
          <span class="spark">‚ú®</span>
          <b>–¢–≤–æ–∏ –∫–æ—Ä–æ–Ω–Ω—ã–µ —Å–ª–æ–≤–µ—á–∫–∏:</b>
          <span id="interestsInline"></span>
        </div>

        <div class="note" id="plansNote">
          <span class="spark">üó∫Ô∏è</span>
          <b>–û–±—â–∏–µ –ø–ª–∞–Ω—ã:</b>
          <div id="plansList" style="margin-top:8px; display:flex; flex-direction:column; gap:6px;"></div>
        </div>

        <div class="note" id="quotesNote">
          <span class="spark">üí¨</span>
          <b>–ù–∞—à–∏ —Ü–∏—Ç–∞—Ç—ã:</b>
          <div style="margin-top:8px;">
            <div id="quoteBox" style="padding:10px 10px; border-radius:16px; background:rgba(0,0,0,.16); border:1px solid rgba(255,255,255,.12);">
              <span id="quoteText"></span>
            </div>
            <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
              <button class="btn secondary small" id="nextQuote">–ï—â—ë —Ü–∏—Ç–∞—Ç—É</button>
              <button class="btn ghost small" id="surprise">–ù—É—Ä–∞ –∞ –¥–∞–≤–∞–π?</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>
        <div class="actions">
          <button class="btn ghost small" id="back4">‚Üê –ù–∞–∑–∞–¥</button>
          <button class="btn primary" id="next4">–§–∏–Ω–∞–ª</button>
        </div>

        <div class="progress" aria-hidden="true">
          <div class="p"></div><div class="p"></div><div class="p"></div><div class="p on"></div><div class="p"></div>
        </div>
      </div>

      <!-- STEP 5 -->
      <div class="step" data-step="5">
        <div class="kicker"><span class="mini"></span><span>–ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å</span></div>
        <h1 id="finalTitle">–ù—É—Ä–∞, –±—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π? üíû</h1>
        <p id="finalText">
          ¬´–Ω–∞–º –∏ —Ü–µ–ª–æ–π –∂–∏–∑–Ω–∏ –Ω–µ —Ö–≤–∞—Ç–∏—Ç –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –º–æ–º–µ–Ω—Ç–∞–º–∏ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º¬ª
        </p>

        <div class="actions">
          <button class="btn primary" id="yesBtn">–î–ê üíó</button>
          <button class="btn secondary" id="maybeBtn">–≠–º–º‚Ä¶</button>
          <button class="btn ghost" id="noBtn">–ù–µ—Ç</button>
        </div>

        <div class="divider"></div>

        <div class="note" id="afterYes" style="display:none;">
          <span class="spark">üí´</span>
          <b>–£—Ä–∞–∞–∞, –ù—É—Ä–∞.</b> –¢–æ–≥–¥–∞ –∑–∞–∫—Ä–µ–ø–∏–º –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∏—Ç—É–∞–ª:
          —Å–µ–≥–æ–¥–Ω—è ‚Äî —á—É—Ç—å –±–æ–ª—å—à–µ –æ–±—ä—è—Ç–∏–π, –∏ –æ–¥–∏–Ω –Ω–∞—à —à–∞–≥ –∫ –º–µ—á—Ç–∞–º.
          <br><br>
          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn secondary small" id="openMsg">–û—Ç–∫—Ä—ã—Ç—å —Ç–∞–π–Ω–æ–µ –ø–∏—Å—å–º–æ</button>
            <button class="btn ghost small" id="restart">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
          </div>
        </div>

        <div class="progress" aria-hidden="true">
          <div class="p"></div><div class="p"></div><div class="p"></div><div class="p"></div><div class="p on"></div>
        </div>
      </div>

    </section>

    <div class="toast" id="toast">
      <div class="ico">üíå</div>
      <div class="txt">
        <strong id="toastTitle">–ü–æ–¥—Å–∫–∞–∑–∫–∞</strong>
        <small id="toastText">‚Ä¶</small>
      </div>
    </div>
  </main>

  <div class="modal" id="modal">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="–°–æ–æ–±—â–µ–Ω–∏–µ">
      <header>
        <strong>–¢–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ù—É—Ä—ã</strong>
        <button class="btn ghost small" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </header>
      <div class="body">
        <p>–ü–∏—Å–∞–ª–æ –º–æ–µ —Å–µ—Ä–¥—Ü–µ. –ê –Ω–µ —è XD</p>
        <textarea id="msgArea" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å. –Ø —Ä—è–¥–æ–º.'"></textarea>
        <div class="actions" style="margin-top:10px;">
          <button class="btn primary" id="copyMsg">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          <button class="btn secondary" id="shareMsg">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mobile vh fix
    const setVh = () => document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
    setVh();
    window.addEventListener('resize', setVh);

    // ====== CONFIG ======
    // 1) –ü–æ–ª–æ–∂–∏ —Ñ–æ—Ç–æ –≤ –ø–∞–ø–∫—É assets —Ä—è–¥–æ–º —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º:
    //    assets/me.jpg  ‚Äî —Ñ–æ—Ç–æ –î–∞—Å—Ç–∞–Ω–∞
    //    assets/her.jpg ‚Äî —Ñ–æ—Ç–æ –ù—É—Ä—ã
    const CONFIG = {
      yourName: "–î–∞—Å—Ç–∞–Ω",
      herName: "–ù—É—Ä–∞ üíù",

      interests: [
        "–ú–∞–ª–¥–∞—Å—ç",
        "–û–º–Ω–∏—á–∫–∞",
        "–ú–∏–ª–∏",
        "—Ç—É—É—É—É—É—Ñ—Ñ—Ñ"
      ],

      plans: [
        "–≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –≤ 2026 –≥–æ–¥—É",
        "—Å–≤–æ–∂—É —Ç–µ–±—è –≤ –≥–æ—Ä—ã",
        "–ê–ª–º–∞—Ç—É –ø–æ–∫–∞–∂—É—É",
        "—Ç—ã —Ä–∞—Å—Å–∫–∞–∂–µ—à—å –º–Ω–µ –∏—Å—Ç–æ—Ä–∏—é –†–æ—Å—Å–∏–∏, –ø—Ä–æ –¥–∏–Ω–∞—Å—Ç–∏–∏",
        "—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω —Å –≤–∏–¥–æ–º",
        "—è –ø—Ä–∏–µ–¥—É –ú–æ—Å–∫–≤—É –∫ —Ç–µ–±–µ",
        "–Ω–∞–∫—É–ø–∏–º —Ä–∞–∑–Ω—ã–µ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –≤–∫—É—Å–Ω—è—à–∫–∏ –∏ —Å–Ω–∏–º–µ–º –æ–±–∑–æ—Ä –Ω–∞ –Ω–∏—Ö",
        "–≥–∞—Å—Ç—Ä–æ—Ç—É—Ä –ø–æ –¢–∞—à–∫–µ–Ω—Ç—É",
        "—Å–Ω–∏–º–µ–º —Ä–∏–ª—Å –Ω–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏, –∫–∞–∫ —É –Ω–∞—Å –≤—Å—ë –ø–æ–ª—É—á–∏–ª–æ—Å—å",
        "–∫—É–ø–∏–º —á—Ç–æ-—Ç–æ –ø–∞—Ä–Ω–æ–µ (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ, –Ω–µ —Ç–∏–ø–∏—á–Ω—ã–µ –≤–µ—â–∏ –¥–ª—è –ø–∞—Ä–æ—á–µ–∫, –∞ –≤–ª–æ–∂–∏—Ç—å —Å–≤–æ–π —Å–º—ã—Å–ª)",
        "–æ–±—ä–µ–∑–¥–∏–º –ò–ö",
        "—É—Å—Ç—Ä–æ–∏–º –ø–∏–∫–Ω–∏–∫ –≤ –ª–µ—Å—É –∏ –Ω–∞ –ø–ª—è–∂–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –∑–∞–∫–∞—Ç",
        "–ø–æ–æ–±—â–∞–µ–º—Å—è –≤ –∂–∏–≤—É—é: —Å–µ–º–µ–π–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –±—ã—Ç, –∫–∞–∫ –º–∞–º–∞/–∫–∞–∫ –ø–∞–ø–∞, –ø—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–∏ –º–æ–º–µ–Ω—Ç—ã",
        "–ø–æ—Å–º–æ—Ç—Ä–∏–º –≤–º–µ—Å—Ç–µ —Ñ–∏–ª—å–º—ã (—Å–æ—Å—Ç–∞–≤–∏–º —Å–ø–∏—Å–æ–∫)",
        "–ø–æ–¥—Ä–∏—Ñ—Ç–∏–º –Ω–æ—á—å—é"
      ],

      quotes: [
        "¬´–Ω–∞–º –∏ —Ü–µ–ª–æ–π –∂–∏–∑–Ω–∏ –Ω–µ —Ö–≤–∞—Ç–∏—Ç –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –º–æ–º–µ–Ω—Ç–∞–º–∏ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º¬ª",
        "¬´–¥–ª—è –∫–æ–≥–æ-—Ç–æ —Ç—ã —Ç–æ—Ç —Å–∞–º—ã–π —á–µ–ª–æ–≤–µ–∫, —Å –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º¬ª",
        "¬´–ø—É—Å—Ç—å –≤–∞—à–µ —Å–µ—Ä–¥—Ü–µ –±—É–¥–µ—Ç —Å–ø–æ–∫–æ–π–Ω—ã–º,–∑–Ω–∞—è,—á—Ç–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –¥–ª—è –≤–∞—Å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–π–¥—ë—Ç –º–∏–º–æ,–∞ —Ç–æ,—á—Ç–æ –ø—Ä–æ—à–ª–æ, –Ω–µ –±—ã–ª–æ –≤–∞–º –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ¬ª"
      ],

      compliments: [
        "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä. ü§ç",
        "–° —Ç–æ–±–æ–π —É –º–µ–Ω—è –≤–Ω—É—Ç—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ.",
        "–¢—ã –∫—Ä–∞—Å–∏–≤–∞—è. –û—á–µ–Ω—å. (–∏ —ç—Ç–æ —Ñ–∞–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è –æ—Ç—Ä–∏—Ü–∞—Ç—å)",
        "–¢—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å –º–∏—Ä —è—Ä—á–µ.",
        "–¢–≤–æ–π –≤–∫—É—Å ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ.",
        "–û–±–æ–∂–∞—é —Ç–≤–µ—Ö —Å–º–µ—Ö"
      ],

      noRunTexts: [
        "–û–π, –∫–∞–∂–µ—Ç—Å—è, —ç—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Å—Ç–µ—Å–Ω—è–µ—Ç—Å—è üòÖ",
        "–ù–µ—Ç-–Ω–µ—Ç, –Ω–µ —Å—é–¥–∞‚Ä¶ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ üôà",
        "–û–Ω–∞ —É–±–µ–∂–∞–ª–∞. –ö–∞–∫ –º–æ–∏ –º—ã—Å–ª–∏, –∫–æ–≥–¥–∞ —Ç—ã —Ä—è–¥–æ–º ü´†",
        "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ‚Ä¶ –ø–æ–ø—Ä–æ–±—É–π –Ω–∞–∂–∞—Ç—å –î–ê üíó"
      ],

      maybeTexts: [
        "–ú–º–º‚Ä¶ —è –ø–æ—Å—Ç–∞–≤–ª—é —ç—Ç–æ –∫–∞–∫ ‚Äò–î–ê, –Ω–æ —è —Å—Ç–µ—Å–Ω—è—é—Å—å‚Äô üòå",
        "–°—á–∏—Ç–∞—é, —á—Ç–æ —ç—Ç–æ ‚Äò–î–ê‚Äô, –ø—Ä–æ—Å—Ç–æ —Å –ø–∞—É–∑–æ–π üòâ",
        "–û–∫–µ–π. –î–∞–≤–∞–π —Ç–∞–∫: —Ç—ã –Ω–∞–∂–∏–º–∞–µ—à—å ‚Äò–î–ê‚Äô, –∞ —è —É–ª—ã–±–∞—é—Å—å"
      ]
    };

    // ====== UI HELPERS ======
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const state = {
      step: 1,
      girlName: CONFIG.herName,
      secret: "",
      heart: "",
      accepted: false,
      quoteIndex: 0
    };

    const titleBar = $("#titleBar");
    const subBar = $("#subBar");
    const chipText = $("#chipText");

    function toast(title, text, ico="üíå"){
      const t = $("#toast");
      $("#toastTitle").textContent = title;
      $("#toastText").textContent = text;
      t.querySelector(".ico").textContent = ico;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=> t.classList.remove("show"), 2400);
    }

    function setStep(n){
      state.step = n;
      $$(".step").forEach(s => s.classList.toggle("active", Number(s.dataset.step) === n));
      chipText.textContent = `—à–∞–≥ ${n} –∏–∑ 5`;

      const her = state.girlName || CONFIG.herName || "–ª—é–±–∏–º–∞—è";

      if(n === 1){
        titleBar.textContent = "–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞";
        // subBar.textContent = `${CONFIG.yourName} ‚Üí ${her}`;
      } else if(n === 2){
        titleBar.textContent = `–î–ª—è ${her}`;
        subBar.textContent = "—Ç–≤–æ–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞";
      } else if(n === 3){
        titleBar.textContent = `–î–ª—è ${her}`;
        subBar.textContent = "–º–∏–Ω–∏-–º–∏—Å—Å–∏—è";
      } else if(n === 4){
        titleBar.textContent = "–ù–∞—à–∏ –º–æ–º–µ–Ω—Ç—ã";
        subBar.textContent = `${CONFIG.yourName} √ó ${her}`;
      } else if(n === 5){
        titleBar.textContent = "–ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å";
        subBar.textContent = "—Ç–æ–ª—å–∫–æ —á–µ—Å—Ç–Ω–æ üôÇ";
      }

      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    // ====== Content injection (interests/plans/quotes) ======
    function renderInterests(){
      const s = CONFIG.interests
        .map(x => `‚Ä¢ ${x}`)
        .join(" &nbsp; ");
      $("#interestsInline").innerHTML = `<span style="display:block; margin-top:6px; color: rgba(255,255,255,.86)">${s}</span>`;
    }

    function renderPlans(){
      const box = $("#plansList");
      box.innerHTML = "";
      CONFIG.plans.forEach((txt, i) => {
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.gap = "8px";
        row.style.alignItems = "flex-start";
        row.style.padding = "9px 10px";
        row.style.borderRadius = "16px";
        row.style.background = "rgba(0,0,0,.16)";
        row.style.border = "1px solid rgba(255,255,255,.12)";
        row.style.boxShadow = "inset 0 1px 0 rgba(255,255,255,.04)";
        row.innerHTML = `
          <span style="flex:0 0 auto; margin-top:1px;">${i < 3 ? "‚≠ê" : "‚≠ê"}</span>
          <span style="color: rgba(255,255,255,.86);">${txt}</span>
        `;
        row.addEventListener("click", () => {
          toast("–ü–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω", `–ö–æ–≥–¥–∞-–Ω–∏–±—É–¥—å: ‚Äú${txt}‚Äù üó∫Ô∏è`, "üó∫Ô∏è");
          burstHearts(10);
        });
        box.appendChild(row);
      });
    }

    function setQuote(idx){
      state.quoteIndex = (idx + CONFIG.quotes.length) % CONFIG.quotes.length;
      $("#quoteText").textContent = CONFIG.quotes[state.quoteIndex];
    }

    // ====== Step 1 ======
    $("#girlName").value = CONFIG.herName;

    $("#startBtn").addEventListener("click", () => {
      const v = $("#girlName").value.trim();
      state.girlName = v || CONFIG.herName;
      // applyNames();
      setStep(2);
      toast("–ü–æ–µ—Ö–∞–ª–∏", `${state.girlName}, —É—Ä–æ–≤–µ–Ω—å 1 –ø—Ä–æ–π–¥–µ–Ω ‚úÖ`, "‚úÖ");
    });

    // $("#skipNameBtn").addEventListener("click", () => {
    //   state.girlName = CONFIG.herName;
    //   applyNames();
    //   setStep(2);
    //   toast("–û–∫", "–ü–æ–π–¥—ë–º –¥–∞–ª—å—à–µ üíó", "üíó");
    // });

    // function applyNames(){
    //   const her = state.girlName || CONFIG.herName;
    //   $("#step2Title").textContent = `${her}, –≤—ã–±–µ—Ä–∏ ‚Äú–∫–ª—é—á–∏–∫‚Äù, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ —Ç–µ–±—è`;
    //   $("#finalTitle").textContent = `${her}, –±—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π? üíû`;
    //   $("#herTag").textContent = her;
    //   $("#subBar").textContent = `${CONFIG.yourName} ‚Üí ${her}`;
    // }

    // ====== Step 2 ======
    const ansBtns = $$('button[data-ans]');
    ansBtns.forEach(b => b.addEventListener("click", () => {
      ansBtns.forEach(x => x.style.filter = "none");
      b.style.filter = "brightness(1.08)";
      state.secret = b.dataset.ans;
      $("#next2").disabled = false;

      const her = state.girlName || CONFIG.herName;
      toast("–ñ–º—è–∫–Ω—É–ª–∞ –Ω–∞ ", `${labelSecret(state.secret)} ‚ú®`, "‚ú®");
    }));

    function labelSecret(v){
      const map = {
        "–≥—Ä–µ—á–∫–∞": "ü•£ –≥—Ä–µ—á–∫–∞",
        "–∫—É—Ä–∏—Ü–∞": "üçó –∫—É—Ä–∏—Ü–∞ –≤ –∫–∏—Å–ª–æ-—Å–ª–∞–¥–∫–æ–º",
        "–∏—Å–∫—É—Å—Å—Ç–≤–æ": "üé® –∏—Å–∫—É—Å—Å—Ç–≤–æ —Ä—É–∫–∞–º–∏",
        "–ª–µ–æ–ø–∞—Ä–¥": "üêÜ –ª–µ–æ–ø–∞—Ä–¥–æ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏"
      };
      return map[v] || v;
    }

    $("#back2").addEventListener("click", () => setStep(1));
    $("#next2").addEventListener("click", () => {
      if(!state.secret) return;
      setStep(3);
      const her = state.girlName || CONFIG.herName;
      toast("–£—Ä–æ–≤–µ–Ω—å 2", `${her}, –±–ª–∏–∂–∞–π—à–∏–µ –ø–ª–∞–Ω—ã`, "‚úÖ");
    });

    // ====== Step 3 ======
    const wobble = $("#wobbleHeart");
    wobble.animate(
      [{transform:"translateX(0) rotate(0deg)"},{transform:"translateX(2px) rotate(1deg)"},{transform:"translateX(-2px) rotate(-1deg)"},{transform:"translateX(0) rotate(0deg)"}],
      {duration: 900, iterations: Infinity}
    );

    const heartBtns = $$('button[data-heart]');
    heartBtns.forEach(b => b.addEventListener("click", () => {
      heartBtns.forEach(x => x.style.filter = "none");
      b.style.filter = "brightness(1.1)";
      state.heart = b.dataset.heart;
      $("#next3").disabled = false;

      const hints = {
        A: "2026 ‚Äî –º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–µ–º. –¢–æ—á–Ω–æ.",
        B: "–ì–æ—Ä—ã –±—É–¥—É—Ç –Ω–∞—à–∏–º–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—è–º–∏.",
        C: "–£–∂–∏–Ω —Å –≤–∏–¥–æ–º ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.",
        D: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è: –ú–æ—Å–∫–≤–∞, –¢–∞—à–∫–µ–Ω—Ç –∏ –¥–∞–ª—å—à–µ."
      };
      toast("–°–µ—Ä–¥—Ü–µ –≤—ã–±—Ä–∞–Ω–æ", hints[state.heart] || "‚ù§Ô∏è", "üíó");
    }));

    $("#back3").addEventListener("click", () => setStep(2));
    $("#next3").addEventListener("click", () => {
      if(!state.heart) return;
      setStep(4);
      toast("–ì–∞–ª–µ—Ä–µ—è", "–ù–∞–∂–º–∏ –Ω–∞ —Ñ–æ—Ç–æ ‚Äî –±—É–¥–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç üí¨", "üì∏");
    });

    // ====== Step 4 ======
    $("#back4").addEventListener("click", () => setStep(3));
    $("#next4").addEventListener("click", () => setStep(5));

    const imgMe = $("#imgMe");
    const imgHer = $("#imgHer");

    [imgMe, imgHer].forEach((img, idx) => {
      img.addEventListener("click", () => {
        const c = rand(CONFIG.compliments);
        const her = state.girlName || CONFIG.herName;
        toast("–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç", idx === 1 ? `${her}, ${c}` : c, "üí¨");
        burstHearts(22);
      });
      img.addEventListener("error", () => {
        toast("–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", "–î–æ–±–∞–≤—å assets/me.jpg –∏ assets/her.jpg —Ä—è–¥–æ–º —Å —Ñ–∞–π–ª–æ–º üóÇÔ∏è", "üóÇÔ∏è");
      }, { once:true });
    });

    $("#nextQuote").addEventListener("click", () => {
      setQuote(state.quoteIndex + 1);
      burstHearts(10);
      toast("–¶–∏—Ç–∞—Ç–∞", "–ï—â—ë –æ–¥–Ω–∞ ‚Äî –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é üí¨", "üí¨");
    });

    $("#surprise").addEventListener("click", () => {
      const her = state.girlName || CONFIG.herName;
      const pick = rand(CONFIG.plans);
      toast("–°—é—Ä–ø—Ä–∏–∑-–∏–¥–µ—è", `${her}, –¥–∞–≤–∞–π: ‚Äú${pick}‚Äù üòå`, "üéÅ");
      burstHearts(18);
    });

    // ====== Step 5 ======
    $("#yesBtn").addEventListener("click", () => {
      state.accepted = true;
      $("#afterYes").style.display = "block";
      burstHearts(70);

      const her = state.girlName || CONFIG.herName;
      const quote = CONFIG.quotes[0];
      const planA = "–≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è –≤ 2026 –≥–æ–¥—É";
      const planB = "—Å–≤–æ–¥–∏—Ç—å —Ç–µ–±—è –≤ –≥–æ—Ä—ã";

      toast("–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç", `${her}, —Ç–µ–ø–µ—Ä—å —Ç—ã –º–æ—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíû`, "üíû");

      $("#finalText").textContent =
        `${quote}\n\n` +
        `–ò –µ—â—ë: –¥–ª—è –∫–æ–≥–æ-—Ç–æ —Ç—ã —Ç–æ—Ç —Å–∞–º—ã–π —á–µ–ª–æ–≤–µ–∫, —Å –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º.\n` +
        `–î–ª—è –º–µ–Ω—è ‚Äî —ç—Ç–æ —Ç—ã.\n\n` +
        `–î–∞–≤–∞–π –Ω–∞—á–Ω—ë–º —Å –º–∞–ª–æ–≥–æ: ${labelSecret(state.secret)} —Å–µ–≥–æ–¥–Ω—è.\n` +
        `–ê –¥–∞–ª—å—à–µ ‚Äî ${planA}, ${planB}, –∏ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–∑ –Ω–∞—à–∏—Ö –ø–ª–∞–Ω–æ–≤.`;
    });

    $("#maybeBtn").addEventListener("click", () => {
      toast("–•–º–º‚Ä¶", rand(CONFIG.maybeTexts), "üôÇ");
      $("#yesBtn").animate(
        [{transform:"scale(1)"},{transform:"scale(1.03)"},{transform:"scale(1)"}],
        {duration: 420, iterations: 1, easing:"cubic-bezier(.2,.9,.2,1)"}
      );
    });

    // ‚Äúno‚Äù runs away
    const noBtn = $("#noBtn");
    noBtn.addEventListener("pointerenter", runAway);
    noBtn.addEventListener("click", runAway);

    function runAway(){
      const stage = $("#stage");
      const rect = stage.getBoundingClientRect();
      const b = noBtn.getBoundingClientRect();

      const pad = 10;
      const maxX = rect.width - b.width - pad;
      const maxY = 180;
      const x = Math.max(pad, Math.min(maxX, Math.random() * maxX));
      const y = Math.max(pad, Math.min(maxY, Math.random() * maxY));

      noBtn.style.position = "relative";
      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
      toast("–ù–µ —Ç–∞–∫ –±—ã—Å—Ç—Ä–æ", rand(CONFIG.noRunTexts), "üôà");
      burstHearts(10);
    }

    // Message modal
    const modal = $("#modal");
    $("#openMsg").addEventListener("click", () => {
      modal.classList.add("show");
      const her = state.girlName || CONFIG.herName;

      const pickPlans = [
        "–≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è –≤ 2026 –≥–æ–¥—É",
        "—Å–≤–æ–¥–∏—Ç—å —Ç–µ–±—è –≤ –≥–æ—Ä—ã",
        "—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω —Å –≤–∏–¥–æ–º",
        "–≥–∞—Å—Ç—Ä–æ—Ç—É—Ä –ø–æ –¢–∞—à–∫–µ–Ω—Ç—É",
        "–ø–æ–µ—Ö–∞—Ç—å –º–Ω–µ –≤ –ú–æ—Å–∫–≤—É –±—É–π—Ä—É—Å–∞ –≤ –≥–æ—Å—Ç–∏ —Ç–µ–±–µ"
      ].filter(Boolean);

      $("#msgArea").value =
        `${her}, —ç—Ç–æ –î–∞—Å—Ç–∞–Ω. –û–±–æ–∂–∞—é —Ç–≤–æ—é —Ü–∏—Ç–∞—Ç—É\n` +
        `${CONFIG.quotes[0]}\n\n` +
        `–Ø —Ö–æ—á—É —Å–¥–µ–ª–∞—Ç—å —Å —Ç–æ–±–æ–π –≤—Å—ë, —á—Ç–æ –º—ã –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–∏: ` +
        `${pickPlans.slice(0,3).join(", ")}‚Ä¶\n\n` +
        `–ì–ª–∞–≤–Ω–æ–µ –±—É–¥—å —Ä—è–¥–æ–º üíó`;
      $("#msgArea").focus();
    });

    $("#closeModal").addEventListener("click", () => modal.classList.remove("show"));
    modal.addEventListener("click", (e) => { if(e.target === modal) modal.classList.remove("show"); });

    $("#copyMsg").addEventListener("click", async () => {
      const text = $("#msgArea").value.trim();
      if(!text){ toast("–ü—É—Å—Ç–æ", "–ù–∞–ø–∏—à–∏ –ø–∞—Ä—É —Å–ª–æ–≤ üôÇ"); return; }
      try{
        await navigator.clipboard.writeText(text);
        toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ", "–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ WhatsApp/Telegram üí¨", "‚úÖ");
      }catch{
        toast("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å", "–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é ‚Äî –≤—ã–¥–µ–ª–∏ —Ç–µ–∫—Å—Ç ‚úçÔ∏è", "‚úçÔ∏è");
      }
    });

    $("#shareMsg").addEventListener("click", async () => {
      const text = $("#msgArea").value.trim();
      if(!text){ toast("–ü—É—Å—Ç–æ", "–ù–∞–ø–∏—à–∏ –ø–∞—Ä—É —Å–ª–æ–≤ üôÇ"); return; }
      if(navigator.share){
        try{
          await navigator.share({ text });
          toast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ", "–ö—Ä–∞—Å–∏–≤–æ üòå", "üì®");
        }catch{
          toast("–û–∫", "–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é üí¨", "üí¨");
        }
      }else{
        toast("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è", "–ù–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –Ω–µ—Ç share API ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ", "‚ÑπÔ∏è");
      }
    });

    $("#restart").addEventListener("click", () => {
      state.step = 1;
      state.secret = "";
      state.heart = "";
      state.accepted = false;
      $("#next2").disabled = true;
      $("#next3").disabled = true;
      $("#afterYes").style.display = "none";
      noBtn.style.left = "0px";
      noBtn.style.top = "0px";
      $("#girlName").value = CONFIG.herName;
      state.girlName = CONFIG.herName;
      // applyNames();
      setQuote(0);
      setStep(1);
      burstHearts(26);
    });

    // ====== HEART PARTICLES (canvas) ======
    const canvas = $("#hearts");
    const ctx = canvas.getContext("2d");
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    let W=0,H=0;

    function resizeCanvas(){
      W = Math.floor(window.innerWidth * DPR);
      H = Math.floor(window.innerHeight * DPR);
      canvas.width = W;
      canvas.height = H;
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    const prefersReduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    const particles = [];
    function heartPath(t){
      const x = 16 * Math.pow(Math.sin(t),3);
      const y = -(13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
      return {x,y};
    }

    function spawnHeart(x, y, boost=1){
      const size = (8 + Math.random()*10) * DPR * boost;
      particles.push({
        x: x * DPR,
        y: y * DPR,
        vx: (Math.random()*2 - 1) * 0.45 * DPR,
        vy: (-1.2 - Math.random()*1.2) * 0.7 * DPR,
        rot: Math.random()*Math.PI*2,
        vr: (Math.random()*2 - 1) * 0.03,
        size,
        life: 0,
        ttl: 90 + Math.random()*55,
        hue: 330 + Math.random()*40,
        alpha: 0.9
      });
    }

    function burstHearts(n=24){
      if(prefersReduced) return;
      const cx = window.innerWidth * (0.35 + Math.random()*0.3);
      const cy = window.innerHeight * (0.25 + Math.random()*0.25);
      for(let i=0;i<n;i++){
        spawnHeart(cx + (Math.random()*120-60), cy + (Math.random()*60-30), 1);
      }
    }

    let ambientTick = 0;

    function drawHeart(p){
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);

      const s = p.size;
      ctx.scale(s/34, s/34);

      ctx.beginPath();
      for(let i=0;i<=Math.PI*2+0.05;i+=0.1){
        const pt = heartPath(i);
        ctx.lineTo(pt.x, pt.y);
      }
      ctx.closePath();

      ctx.fillStyle = `hsla(${p.hue}, 95%, 66%, ${p.alpha})`;
      ctx.shadowColor = `hsla(${p.hue}, 95%, 60%, ${p.alpha*0.65})`;
      ctx.shadowBlur = 18 * DPR;
      ctx.fill();

      ctx.restore();
    }

    function tick(){
      if(!prefersReduced){
        ambientTick++;
        if(ambientTick % 18 === 0 && particles.length < 140){
          spawnHeart(Math.random()*window.innerWidth, window.innerHeight + 10, 0.85);
        }
      }

      ctx.clearRect(0,0,W,H);

      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.life++;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;

        const t = p.life / p.ttl;
        p.alpha = Math.max(0, 0.9 * (1 - t));
        p.vy += 0.008 * DPR;

        if(p.alpha <= 0 || p.y < -80*DPR){
          particles.splice(i,1);
          continue;
        }
        drawHeart(p);
      }

      requestAnimationFrame(tick);
    }
    tick();

    // ====== Init ======
    function init(){
      renderInterests();
      renderPlans();
      setQuote(0);
      // applyNames();

      $("#next2").disabled = true;
      $("#next3").disabled = true;

      setStep(1);
      setTimeout(() => burstHearts(28), 260);
      setTimeout(() => toast("–ü–æ–¥—Å–∫–∞–∑–∫–∞", "–ù–∞–∂–º–∏ ‚Äú–ù–∞—á–∞—Ç—å‚Äù üíó", "üíó"), 1200);

      // Soft auto-rotate quote while on step 4
      setInterval(() => {
        if(state.step === 4){
          setQuote(state.quoteIndex + 1);
        }
      }, 6500);
    }
    init();
  </script>
</body>
</html>
